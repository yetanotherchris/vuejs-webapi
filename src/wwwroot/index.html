<html>
<head>
    <script src="axios.min.js"></script>
    <script src="vue.js"></script>
    <script>
        // Decent tutorial: https://coligo.io/vuejs-the-basics/

        document.addEventListener("DOMContentLoaded", function (event) {
            var vm = new Vue(
                {
                    el: "#vue-instance",
                    data: {
                        items: [],
                        editTitle: "Add item"
                    },
                    created: function () {
                        created(this);
                    },
                    methods: {
                        add: function () {
                            add();
                        },
                        update: function (item, index) {
                            update(this, item, index);
                        }
                    }
                });

            function created(context) {

                axios.get("/api/values")
                    .then(function (response) {
                        // Replace the data
                        // See https://vuejs.org/v2/guide/list.html#Replacing-an-Array
                        context.items = context.items.concat(response.data);
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            }

            function add() {
                var that = this;
                var newItem = {
                    id: that.items.length,
                    name: document.getElementById("name").value,
                    price: parseFloat(document.getElementById("price").value)
                };

                axios.post("/api/values", newItem)
                    .then(function (response) {
                        that.items.push(newItem);
                        console.log(response);
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            }

            function update(context, item, index) {

                var updatedItem = {
                    id:  item.id,
                    name: document.getElementById("name").value,
                    price: parseFloat(document.getElementById("price").value)
                };

                axios.put("/api/values/" + item.id, updatedItem)
                    .then(function (response) {
                        console.log(response);
                        Vue.set(context.items, index, updatedItem);
                        console.log(context.items);
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            }
        });
    </script>
</head>
<body>
    <div id="vue-instance">
        <ul>
            <li v-for="(index, item) in items">
                {{ index + 1 }}. {{ item.name }} - ${{ item.price }}
                <button :key="item.id" v-on:click="update(item, index)" type="button">Edit</button>
            </li>
        </ul>

        <h3>{{ editTitle }}</h3>
        <input type="text" id="name" placeholder="name" />
        <input type="text" id="price" placeholder="price" />
        <button @click="add" type="button">add</button>
    </div>
</body>
</html>